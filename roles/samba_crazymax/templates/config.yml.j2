auth:
{% for user in samba.users %}
  - user: {{ user.name }}
    group: {{ user.name }}
    uid: {{ user.id }}
    gid: {{ user.id }}
    password: {{ user.password }}
{% endfor %}

global:
  - "force user = {{ smb_primary_user }}"
  - "force group = {{ smb_primary_user }}"
  - "hosts allow = {{ smb_subnet }}"
  - "server min protocol = {{ smb_min_protocol }}"
  - "client signing = required"
  - "server signing = mandatory"
  - "server smb encrypt = required"
  - "client ipc signing = required"
  - "guest ok = no"
  - "restrict anonymous = 2"
  - "usershare allow guests = no"
  - "invalid users = root @sudo @wheel"
  - "server string = {{ smb_server_string }}"

share:
{% for share in samba.shares %}
  - name: {{ share.name }}
    path: /samba/{{ share.name }}
    browsable: {{ share.browsable }}
    readonly: {{ share.readonly }}
    guestok: {{ share.guestok }}
    writelist: {{ share.writelist | join(' ') }}
    veto: no
    validusers: {{ share.validusers | join(' ') }}
{% endfor %}
